$(document).ready(function(){typeReponse();emplacementChantier();typeRendezVous()});function typeReponse(){$("#proto-reponse").on("click",function(){var prototypeDeChamps=$(this).find("option:selected").attr("data-prototype");prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#reponse li").length>0)$("ul#reponse li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);newLi.appendTo($("ul#reponse"))});var serialisationReponse=$("select#proto-reponse").attr("data-reponse-prev");if(serialisationReponse!=null){var jsonToJavascriptObject=$.parseJSON(serialisationReponse);switch(jsonToJavascriptObject.reponse.class){case"MairieVoreppe\\DemandeTravauxBundle\\Entity\\NonConcerne":{var prototypeDeChamps=$("select option#mairievoreppe_demandetravauxbundle_nonconcerne").attr("data-prototype");var distance=jsonToJavascriptObject.reponse.distance_n_c;prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#reponse li").length>0)$("ul#reponse li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);console.log("distance => "+distance);newLi.find("input#mairievoreppe_demandetravauxbundle_recepissedict_reponse_0_distanceNC").val(distance);newLi.find("input#mairievoreppe_demandetravauxbundle_recepissedt_reponse_0_distanceNC").val(distance);newLi.appendTo($("ul#reponse"));break}case"MairieVoreppe\\DemandeTravauxBundle\\Entity\\DemandeImprecise":{var prototypeDeChamps=$("select option#mairievoreppe_demandetravauxbundle_demandeimprecise").attr("data-prototype");var description=jsonToJavascriptObject.reponse.description;prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#reponse li").length>0)$("ul#reponse li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);newLi.find("textarea#mairievoreppe_demandetravauxbundle_recepissedict_reponse_0_description").val(description);newLi.find("textarea#mairievoreppe_demandetravauxbundle_recepissedt_reponse_0_description").val(description);newLi.appendTo($("ul#reponse"));break}case"MairieVoreppe\\DemandeTravauxBundle\\Entity\\Concerne":{var prototypeDeChamps=$("select option#mairievoreppe_demandetravauxbundle_concerne").attr("data-prototype");var cat_roa=jsonToJavascriptObject.reponse.categorie_reseau_ouvrage;prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#reponse li").length>0)$("ul#reponse li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);console.log("description => "+cat_roa);var inputCatRo;if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedict_reponse_0_categorieReseauOuvrage input").length)inputCatRo=newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedict_reponse_0_categorieReseauOuvrage input");else if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedt_reponse_0_categorieReseauOuvrage input").length)inputCatRo=newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedt_reponse_0_categorieReseauOuvrage input");$.each(inputCatRo,function(index,value){var labelTypeReseau=$(this).parent().text();var abreviation=$(this).parent().text().substr(0,2);for(i=0;i<cat_roa.length;i++){console.log(cat_roa[i].code+"=="+abreviation);if(cat_roa[i].code===abreviation){$(this).prop("checked","checked")}}});newLi.appendTo($("ul#reponse"));break}default:{break}}}}function emplacementChantier(){var prototypeDeChampsRO=$("table#list-emplacement-reseau-ouvrage").attr("prototype-reo");var nbChampsROExistant=$("table#list-emplacement-reseau-ouvrage tbody tr").length;var nombreDeChamps=2,i=0;while(i<nombreDeChamps-nbChampsROExistant){unChamp=prototypeDeChampsRO.replace(/__name__/g,i);console.log(unChamp);var newTr=$('<tr id="RO_'+i+'"></tr>');var containerHtml=$("<div></div>").html(unChamp);var inputReference=containerHtml.find('input[field="reference"]').parent();var inputEchelle=containerHtml.find('input[field="echelle"]').parent();var inputDateEdition=containerHtml.find('div[field="dateEdition"]');var inputSensible=containerHtml.find('input[field="sensible"]').parent();var inputProfondeurReglMini=containerHtml.find('input[field="profondeurReglMini"]').parent();var inputMateriauxReseau=containerHtml.find('input[field="materiauxReseau"]').parent();var tdReference=$("<td></td>").html(inputReference);var tdEchelle=$("<td></td>").html(inputEchelle);var tdDateEdition=$("<td></td>").html(inputDateEdition);var tdSensible=$("<td></td>").html(inputSensible);var tdProfondeurReglMini=$("<td></td>").html(inputProfondeurReglMini);var tdMateriauxReseau=$("<td></td>").html(inputMateriauxReseau);tdReference.appendTo(newTr);tdEchelle.appendTo(newTr);tdDateEdition.appendTo(newTr);tdSensible.appendTo(newTr);tdProfondeurReglMini.appendTo(newTr);tdMateriauxReseau.appendTo(newTr);newTr.appendTo($("table#list-emplacement-reseau-ouvrage tbody"));i++}}function typeRendezVous(){$("#proto-rendez-vous").on("click",function(){if($("#mairievoreppe_demandetravauxbundle_recepissedict_priseRendezVous").length){$("#mairievoreppe_demandetravauxbundle_recepissedict_priseRendezVous").prop("checked",true)}else{if($("#mairievoreppe_demandetravauxbundle_recepissedt_priseRendezVous").length){$("#mairievoreppe_demandetravauxbundle_recepissedt_priseRendezVous").prop("checked",true)}}var prototypeDeChamps=$(this).find("option:selected").attr("data-prototype");if($("ul#rendez-vous li").length>0)$("ul#rendez-vous li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);newLi.appendTo($("#rendez-vous"))});if($("#mairievoreppe_demandetravauxbundle_recepissedict_priseRendezVous").length){$("#mairievoreppe_demandetravauxbundle_recepissedict_priseRendezVous").click(function(){if($(this).is(":checked")==false){$("#rendez-vous").empty();$("#mairievoreppe_demandetravauxbundle_recepissedict_priseRendezVous").prop("checked",false)}})}else{if($("#mairievoreppe_demandetravauxbundle_recepissedt_priseRendezVous").length){$("#mairievoreppe_demandetravauxbundle_recepissedt_priseRendezVous").click(function(){if($(this).is(":checked")==false){$("#rendez-vous").empty();$("#mairievoreppe_demandetravauxbundle_recepissedt_priseRendezVous").prop("checked",false)}})}}var serialisationRdv=$("select#proto-rendez-vous").attr("data-rendez-vous-prev");if(serialisationRdv!=null){var jsonToJavascriptObject=$.parseJSON(serialisationRdv);switch(jsonToJavascriptObject.rendez_vous.class){case"MairieVoreppe\\DemandeTravauxBundle\\Entity\\CommunAccord":{var prototypeDeChamps=$("select option#mairievoreppe_demandetravauxbundle_communaccord").attr("data-prototype");var dateRetenue=jsonToJavascriptObject.rendez_vous.date_retenue;var dateFinal=dateStringToInputFormDate(dateRetenue);prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#rendez-vous li").length>0)$("ul#rendez-vous li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);console.log(dateFinal);if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0").length){newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_date_day").val(dateFinal.day);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_date_month").val(dateFinal.month);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_date_year").val(dateFinal.year);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_time_hour").val(dateFinal.hour);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_time_minute").val(dateFinal.minute)}else{if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0").length){newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_date_day").val(dateFinal.day);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_date_month").val(dateFinal.month);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_date_year").val(dateFinal.year);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_time_hour").val(dateFinal.hour);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_time_minute").val(dateFinal.minute)}}newLi.appendTo($("ul#rendez-vous"));break}case"MairieVoreppe\\DemandeTravauxBundle\\Entity\\InitiativeDeclarant":{var prototypeDeChamps=$("select option#mairievoreppe_demandetravauxbundle_initiativedeclarant").attr("data-prototype");var dateRetenue=jsonToJavascriptObject.rendez_vous.date_retenue;var dateFinal=dateStringToInputFormDate(dateRetenue);prototypeDeChamps=prototypeDeChamps.replace(/__name__label__/,"");if($("ul#rendez-vous li").length>0)$("ul#rendez-vous li").remove();ensembleDeChampConcret=prototypeDeChamps.replace(/__name__/g,0);var newLi=$("<li></li>").html(ensembleDeChampConcret);console.log(dateFinal);if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0").length){newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_day").val(dateFinal.day);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_month").val(dateFinal.month);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedict_rendezVous_0_dateRetenue_year").val(dateFinal.year)}else{if(newLi.find("div#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0").length){newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_day").val(dateFinal.day);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_month").val(dateFinal.month);newLi.find("select#mairievoreppe_demandetravauxbundle_recepissedt_rendezVous_0_dateRetenue_year").val(dateFinal.year)}}newLi.appendTo($("ul#rendez-vous"));break}default:{alert("dans la switch");alert("pas de type de rendezVous identifiée");break}}}}function dateStringToInputFormDate(date){var objectDate=new Date(date);var dateFinal=[];var month=objectDate.getMonth()+1;var day=objectDate.getDate();var year=objectDate.getFullYear();var hour=objectDate.getHours();var minute=objectDate.getMinutes();dateFinal={day:day,month:month,year:year,hour:hour,minute:minute};return dateFinal}