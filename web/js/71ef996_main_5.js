var autocompletesWraps=new Array;$(document).ready(function(){if($(".modal").length){$(".modal").modal({backdrop:"static",keyboard:false});$(".modal").modal("show")}$("#mairievoreppe_demandetravauxbundle_dtdict_dt_numeroTeleservice").change(function(){var numService=$("#mairievoreppe_demandetravauxbundle_dtdict_dt_numeroTeleservice").val();$("#mairievoreppe_demandetravauxbundle_dtdict_numeroTeleservice").val(numService)});$("#mairievoreppe_demandetravauxbundle_dtdict_dtDictCommune").change(function(){var numService=$("#mairievoreppe_demandetravauxbundle_dtdict_dt_numeroTeleservice").val();$("#mairievoreppe_demandetravauxbundle_dtdict_numeroTeleservice").val(numService)});if($("#adresse-fields-list").length!==0){var numInstance=0;$.each($("[id=adresse-fields-list]"),function(){gestionPrototypeAdresse($(this),numInstance,1);numInstance++})}else{initializeMonoAdresse()}if($("#contact-urgent-fields-list").length!==0){var numInstance=0;$.each($("[id=contact-urgent-fields-list]"),function(){ajouterContactUrgent($(this),numInstance);numInstance++})}$(".image-loading-dt-dict img").hide();$("#recuperer-info-dt").click(function(){remplirDtDictInformationBase();remplirDtDictAdresse();remplirDtDictContactUrgent()});$("#recup-dt").click(function(){remplirDictLieeDtInformationBase();remplirDictLieDtAdresse();remplirDtDictLieContactUrgent()})});function gestionPrototypeAdresse(instance,index,nbreDeChampsAdresse){var listeAdresseElmt=instance.find("li");var adresseCount=listeAdresseElmt.length;var prototypeDeChamps=instance.attr("data-prototype");var i=0;var j=adresseCount;$.each(instance.find("input[autocomplete]").closest("li"),function(){var nombreAleatoire=genererNombreAleatoire();$(this).attr("id","adresse_"+nombreAleatoire+"_"+adresseCount+"_"+index);autocompletesWraps.push("adresse_"+nombreAleatoire+"_"+adresseCount+"_"+index);i++});while(j<nbreDeChampsAdresse){unChamp=prototypeDeChamps.replace(/__name__/g,i);unChamp=unChamp.replace(/<div><button type="submit"(.*)<\/button><\/div>/,"");var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="adresse_'+nombreAleatoire+"_"+adresseCount+"_"+index+'"></li>').html(unChamp);autocompletesWraps.push("adresse_"+nombreAleatoire+"_"+adresseCount+"_"+index);newLi.appendTo(instance);label=$('label[for="adresse_'+nombreAleatoire+"_"+adresseCount+"_"+index+'"]');label.text("Adresse n°"+(i+1)+": ");j++}initializeMutliAdresse();instance.prev("#ajouter-adresse").click(function(){var adresseCount=instance.find("li").length;var newWidget=instance.attr("data-prototype");newWidget=newWidget.replace(/<button type="submit"(.*)<\/button><\/div>/,"");newWidget=newWidget.replace(/__name__/g,adresseCount);adresseCount++;var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="adresse_'+nombreAleatoire+"_"+adresseCount+"_"+index+'"></li>').html(newWidget);autocompletesWraps.push("adresse_"+nombreAleatoire+"_"+adresseCount+"_"+index);addDeleteLink(newLi);newLi.appendTo(instance);initializeMutliAdresse();return false})}function addDeleteLink(prototype){var deleteLink=jQuery('<a href="#" class="btn btn-danger">Supprimer</a>');prototype.append(deleteLink);deleteLink.click(function(e){prototype.remove();e.preventDefault();return false})}var autocompleteMulti=new Array;var placeSearch;var autocomplete;var componentForm={street_number:"short_name",route:"long_name",locality:"long_name",postal_code:"short_name",country:"long_name"};function initializeMutliAdresse(){$.each(autocompletesWraps,function(index,name){if(autocompleteMulti[name]===undefined){autocompleteMulti[name]=new google.maps.places.Autocomplete($("#"+name+" input[autocomplete]")[0],{types:["geocode","establishment"]});google.maps.event.addListener(autocompleteMulti[name],"place_changed",function(){fillInAddress(name)})}else{}})}function initializeMonoAdresse(){autocomplete=new google.maps.places.Autocomplete($("input[autocomplete]")[0],{types:["geocode","establishment"]});google.maps.event.addListener(autocomplete,"place_changed",function(){fillInAddressMono()})}function fillInAddress(name){var place=autocompleteMulti[name].getPlace();for(var component in componentForm){$("#"+name+" input["+component+"]").val("");$("#"+name+" input["+component+"]").prop("disabled",false)}$("#"+name+" input[lieuDit]").val("");$("#"+name+" input[lieuDit]").prop("disabled",false);for(var i=0;i<place.address_components.length;i++){var addressType=place.address_components[i].types[0];if(componentForm[addressType]){if(place.address_components[i][componentForm[addressType]]!==undefined){var val=place.address_components[i][componentForm[addressType]];if(addressType=="route"&&estLieuDit(val)){$("#"+name+" input[lieuDit]").val(val)}else{$("#"+name+" input["+addressType+"]").val(val)}}}}}function fillInAddressMono(){var place=autocomplete.getPlace();for(var component in componentForm){$("input["+component+"]").val("");$("input["+component+"]").prop("disabled",false)}$("input[lieuDit]").val("");$("input[lieuDit]").prop("disabled",false);for(var i=0;i<place.address_components.length;i++){var addressType=place.address_components[i].types[0];if(componentForm[addressType]){if(place.address_components[i][componentForm[addressType]]!==undefined){var val=place.address_components[i][componentForm[addressType]];if(addressType=="route"&&estLieuDit(val)){$("input[lieuDit]").val(val)}else{$("input["+addressType+"]").val(val)}}}}}$(".image-loading-dt-dict img").hide();function geolocate(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var geolocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);var circle=new google.maps.Circle({center:geolocation,radius:position.coords.accuracy});autocomplete.setBounds(circle.getBounds())})}}function estLieuDit(adresse){var estUnLieudit=false;if(adresse.substring(0,8)=="Lieu dit"){estUnLieudit=true}return estUnLieudit}function ajouterContactUrgent(instance,index){var listeContactUrgentElmt=instance.find("li");var contactUrgentCount=listeContactUrgentElmt.length;instance.prev("#ajouter-contact-urgent").click(function(){var contactUrgentCount=instance.find("li").length;var newWidget=instance.attr("data-prototype");newWidget=newWidget.replace(/__name__/g,contactUrgentCount);newWidget=newWidget.replace(/<div><button type="submit"(.*)<\/button><\/div>/,"");contactUrgentCount++;var newLi=$('<li id="contact_urgent_'+contactUrgentCount+"_"+index+'"></li>').html(newWidget);addDeleteLink(newLi);newLi.appendTo(instance);return false})}function serializeObject(formulaire){var o={};var a=formulaire.serializeArray();$.each(formulaire,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}});return o}function remplirDtDictInformationBase(){var form=$("form[name=mairievoreppe_demandetravauxbundle_dtdict]");var inputs=form.find("#partie-dt .information-base input, #partie-dt .information-base textarea");var select=form.find("#partie-dt .information-base select");inputs.each(function(){if($(this).val()!==""){var valeur=$(this).val();var idSource=$(this).attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valeur)}});var valueOptionSelected=select.find(":selected").val();var idSource=select.attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valueOptionSelected)}function remplirDtDictAdresse(){$("#partie-dict ul[id=adresse-fields-list] li").not(":first, .dict-existant").remove();var nombreAdresseDt=$("#partie-dt ul[id=adresse-fields-list]").find("li").length;var nombreAdresseDict=$("#partie-dict ul[id=adresse-fields-list]").find("li").length;for(i=autocompletesWraps.length-1;i>=0;i--){autocompletesWraps[i]=autocompletesWraps[i].replace(/adresse(_(.*)_[\d]_1)/,"");if(autocompletesWraps[i]===""){autocompletesWraps.splice(i,1)}}for(i=nombreAdresseDict;i<nombreAdresseDt;i++){var nombreAdresseDict=$("#partie-dict ul[id=adresse-fields-list]").find("li").length;var newWidget=$("#partie-dict ul[id=adresse-fields-list]").attr("data-prototype");newWidget=newWidget.replace(/<button type="submit"(.*)<\/button><\/div>/,"");newWidget=newWidget.replace(/__name__/g,nombreAdresseDict);nombreAdresseDict++;var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="adresse_'+nombreAleatoire+"_"+nombreAdresseDict+"_"+1+'"></li>').html(newWidget);autocompletesWraps.push("adresse_"+nombreAleatoire+"_"+nombreAdresseDict+"_"+1);addDeleteLink(newLi);newLi.appendTo($("#partie-dict ul[id=adresse-fields-list]"))}initializeMutliAdresse();var form=$("form[name=mairievoreppe_demandetravauxbundle_dtdict]");var inputs=form.find("#partie-dt ul[id=adresse-fields-list] li input");$("#corps").animate({height:"toggle"},2e3);$(".image-loading-dt-dict img").show();setTimeout(function(){inputs.each(function(){if($(this).val()!==""){var valeur=$(this).val();var idSource=$(this).attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valeur)}});$(".image-loading-dt-dict img").hide();$("#corps").animate({height:"toggle"},500)},1e3);return false}function remplirDtDictContactUrgent(){$("#partie-dict ul[id=contact-urgent-fields-list] li").not(".dict-existant").remove();var nombreCuDt=$("#partie-dt ul[id=contact-urgent-fields-list]").find("li").length;var nombreCuDict=$("#partie-dict ul[id=contact-urgent-fields-list]").find("li").length;for(i=nombreCuDict;i<nombreCuDt;i++){var nombreCuDict=$("#partie-dict ul[id=contact-urgent-fields-list]").find("li").length;var newWidget=$("#partie-dict ul[id=contact-urgent-fields-list]").attr("data-prototype");newWidget=newWidget.replace(/<button type="submit"(.*)<\/button><\/div>/,"");newWidget=newWidget.replace(/__name__/g,nombreCuDict);nombreCuDict++;var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="contact_urgent_'+nombreAleatoire+"_"+nombreCuDict+"_"+1+'"></li>').html(newWidget);addDeleteLink(newLi);newLi.appendTo($("#partie-dict ul[id=contact-urgent-fields-list]"))}var form=$("form[name=mairievoreppe_demandetravauxbundle_dtdict]");var inputs=form.find("#partie-dt ul[id=contact-urgent-fields-list] li input");var select=form.find("#partie-dt ul[id=contact-urgent-fields-list] li select");setTimeout(function(){inputs.each(function(){if($(this).val()!==""){var valeur=$(this).val();var idSource=$(this).attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valeur)}})},1e3);setTimeout(function(){select.each(function(){var valueOptionSelected=$(this).find(":selected").val();var idSource=$(this).attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valueOptionSelected)})},1e3);var valueOptionSelected=select.find(":selected").val();var idSource=select.attr("id");var idCible=idSource.replace(/_dt_/,"_");$("#"+idCible).val(valueOptionSelected);return false}function remplirDictLieeDtInformationBase(){var form=$("form[name=mairievoreppe_demandetravauxbundle_demandeintentionct]");var informationBase=form.find(".information-base");var dataDt=$("#recup-dt").attr("data-dt");var arr=$.parseJSON(dataDt);var dateDebutTravaux=dateStringToInputFormDate(arr.date_debut_travaux);console.log(dateDebutTravaux);informationBase.find("input#mairievoreppe_demandetravauxbundle_demandeintentionct_dateDebutTravaux").val(dateDebutTravaux);informationBase.find("input#mairievoreppe_demandetravauxbundle_demandeintentionct_duree").val(arr.duree);setElementInSelectListeByString($("select#mairievoreppe_demandetravauxbundle_demandeintentionct_canalReception"),arr.canal_reception.libelle);informationBase.find("textarea#mairievoreppe_demandetravauxbundle_demandeintentionct_descriptionTravaux").val(arr.description_travaux);informationBase.find("textarea#mairievoreppe_demandetravauxbundle_demandeintentionct_noteComplementaire").val(arr.note_complementaire)}function remplirDictLieDtAdresse(){var form=$("form[name=mairievoreppe_demandetravauxbundle_demandeintentionct]");var dataDt=$("#recup-dt").attr("data-dt");var arr=$.parseJSON(dataDt);$("ul[id=adresse-fields-list] li").not(":first").remove();var nombreAdresseDt=arr.adresses.length;for(i=autocompletesWraps.length-1;i>=0;i--){autocompletesWraps[i]=autocompletesWraps[i].replace(/adresse(_(.*)_[\d]_0)/,"");if(autocompletesWraps[i]===""){autocompletesWraps.splice(i,1)}}for(i=1;i<nombreAdresseDt;i++){var nombreAdresseDict=$("ul[id=adresse-fields-list]").find("li").length;var newWidget=$("ul[id=adresse-fields-list]").attr("data-prototype");newWidget=newWidget.replace(/<button type="submit"(.*)<\/button><\/div>/,"");newWidget=newWidget.replace(/__name__/g,nombreAdresseDict);nombreAdresseDict++;var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="adresse_'+nombreAleatoire+"_"+nombreAdresseDict+"_"+0+'"></li>').html(newWidget);autocompletesWraps.push("adresse_"+nombreAleatoire+"_"+nombreAdresseDict+"_"+0);addDeleteLink(newLi);newLi.appendTo($("ul[id=adresse-fields-list]"))}initializeMutliAdresse();var form=$("form[name=mairievoreppe_demandetravauxbundle_dtdict]");var inputs=form.find("#partie-dt ul[id=adresse-fields-list] li input");$("#corps").animate({height:"toggle"},2e3);$(".image-loading-dt-dict img").show();setTimeout(function(){$.each(arr.adresses,function(i){console.log($(this)[0].ville);console.log("index "+i);if($(this)[0].numero_rue!==undefined&&$(this)[0].numero_rue!="")$('input[street_number="street_number"]').eq(i).val($(this)[0].numero_rue);if($(this)[0].ville!==undefined&&$(this)[0].ville!="")$('input[locality="locality"]').eq(i).val($(this)[0].ville);if($(this)[0].cp!==undefined&&$(this)[0].cp!="")$('input[postal_code="postal_code"]').eq(i).val($(this)[0].cp);if($(this)[0].numero_rue!==undefined&&$(this)[0].numero_rue!="")$('input[street_number="street_number"]').eq(i).val($(this)[0].numero_rue);if($(this)[0].adresse!==undefined&&$(this)[0].adresse!="")$('input[route="route"]').eq(i).val($(this)[0].adresse);if($(this)[0].lieu_dit!==undefined&&$(this)[0].lieu_dit!="")$('input[lieuDit="lieuDit"]').eq(i).val($(this)[0].lieu_dit);if($(this)[0].country!==undefined&&$(this)[0].cp!="")$('input[country="country"]').eq(i).val($(this)[0].cp)});$(".image-loading-dt-dict img").hide();$("#corps").animate({height:"toggle"},500)},1e3);return false}function remplirDtDictLieContactUrgent(){var form=$("form[name=mairievoreppe_demandetravauxbundle_demandeintentionct]");var dataDt=$("#recup-dt").attr("data-dt");var arr=$.parseJSON(dataDt);console.log(arr);$("ul[id=contact-urgent-fields-list] li").remove();var nombreCuDt=arr.contacts_urgent.length;console.log("Après suppression : autocompletesWraps => "+autocompletesWraps);for(i=0;i<nombreCuDt;i++){var nombreCuDict=$("ul[id=contact-urgent-fields-list]").find("li").length;var newWidget=$("ul[id=contact-urgent-fields-list]").attr("data-prototype");newWidget=newWidget.replace(/<button type="submit"(.*)<\/button><\/div>/,"");console.log(newWidget);newWidget=newWidget.replace(/__name__/g,nombreCuDict);nombreCuDict++;var nombreAleatoire=genererNombreAleatoire();var newLi=jQuery('<li id="contact_urgent_'+nombreAleatoire+"_"+nombreCuDict+"_"+0+'"></li>').html(newWidget);console.log(autocompletesWraps);addDeleteLink(newLi);newLi.appendTo($("ul[id=contact-urgent-fields-list]"))}setTimeout(function(){$.each(arr.contacts_urgent,function(i){console.log($(this)[0].ville);console.log("index "+i);if($(this)[0].nom!==undefined&&$(this)[0].nom!="")$('ul[id=contact-urgent-fields-list] li input[id="mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_'+i+'_nom"]').val($(this)[0].nom);if($(this)[0].prenom!==undefined&&$(this)[0].prenom!="")$('ul[id=contact-urgent-fields-list] li input[id="mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_'+i+'_prenom"]').val($(this)[0].prenom);if($(this)[0].email!==undefined&&$(this)[0].email!="")$('ul[id=contact-urgent-fields-list] li input[id="mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_'+i+'_email"]').val($(this)[0].email);if($(this)[0].tel_fixe!==undefined&&$(this)[0].tel_fixe!="")$('ul[id=contact-urgent-fields-list] li input[id="mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_'+i+'_telFixe"]').val($(this)[0].tel_fixe);if($(this)[0].tel_mobile!==undefined&&$(this)[0].tel_mobile!="")$('ul[id=contact-urgent-fields-list] li input[id="mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_'+i+'_telMobile"]').val($(this)[0].tel_mobile);setElementInSelectListeByString($("select#mairievoreppe_demandetravauxbundle_demandeintentionct_contactsUrgent_"+i+"_civilite"),$(this)[0].civilite.abreviation)})},1e3);return false}function dateStringToInputFormDate(date){var objectDate=new Date(date);var month=objectDate.getMonth()+1;var day=objectDate.getDate();var year=objectDate.getFullYear();var dateFinal=year+"-"+month+"-"+day;return dateFinal}function setElementInSelectListeByString(list,textvalue){list.find("option").filter(function(){return this.text==textvalue}).attr("selected",true)}function afficherCalendrier(idInputDate){$("#"+idInputDate).datepicker({dateFormat:"dd/mm/yy",firstDay:1})}function genererNombreAleatoire(){return Math.floor(Math.random()*11e7)+""+(new Date).getUTCMilliseconds()}